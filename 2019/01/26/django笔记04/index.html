<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/qi.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/qi.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Django配置连接数据库settings.py文件中数据库相关的配置 12345678910111213141516DATABASES = &amp;#123;    &apos;default&apos;: &amp;#123;        # 数据库引擎（是mysql还是oracle等）        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,        # 数据库的名字        &apos;">
<meta name="keywords" content="django">
<meta property="og:type" content="article">
<meta property="og:title" content="django笔记04 - 数据库">
<meta property="og:url" content="http://wuliuqi.top/2019/01/26/django笔记04/index.html">
<meta property="og:site_name" content="阿珍爱上了阿强">
<meta property="og:description" content="Django配置连接数据库settings.py文件中数据库相关的配置 12345678910111213141516DATABASES = &amp;#123;    &apos;default&apos;: &amp;#123;        # 数据库引擎（是mysql还是oracle等）        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,        # 数据库的名字        &apos;">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-02-08T09:47:09.099Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="django笔记04 - 数据库">
<meta name="twitter:description" content="Django配置连接数据库settings.py文件中数据库相关的配置 12345678910111213141516DATABASES = &amp;#123;    &apos;default&apos;: &amp;#123;        # 数据库引擎（是mysql还是oracle等）        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,        # 数据库的名字        &apos;">






  <link rel="canonical" href="http://wuliuqi.top/2019/01/26/django笔记04/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>django笔记04 - 数据库 | 阿珍爱上了阿强</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">阿珍爱上了阿强</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">在一个有星星的夜晚</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wuliuqi.top/2019/01/26/django笔记04/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WP">
      <meta itemprop="description" content="飞机从头顶飞过<br>流星也划破那夜空">
      <meta itemprop="image" content="/images/memory.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿珍爱上了阿强">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">django笔记04 - 数据库

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-26 13:51:04" itemprop="dateCreated datePublished" datetime="2019-01-26T13:51:04+08:00">2019-01-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-02-08 17:47:09" itemprop="dateModified" datetime="2019-02-08T17:47:09+08:00">2019-02-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/26/django笔记04/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/01/26/django笔记04/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/2019/01/26/django笔记04/" class="leancloud_visitors" data-flag-title="django笔记04 - 数据库">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">13k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">23 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Django配置连接数据库"><a href="#Django配置连接数据库" class="headerlink" title="Django配置连接数据库"></a>Django配置连接数据库</h1><p>settings.py文件中数据库相关的配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="comment"># 数据库引擎（是mysql还是oracle等）</span></span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="comment"># 数据库的名字</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'dfz'</span>,</span><br><span class="line">        <span class="comment"># 连接mysql数据库的用户名</span></span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="comment"># 连接mysql数据库的密码</span></span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="comment"># mysql数据库的主机地址</span></span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="comment"># mysql数据库的端口号</span></span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="在Django中操作数据库"><a href="#在Django中操作数据库" class="headerlink" title="在Django中操作数据库"></a>在Django中操作数据库</h1><p>下面是使用原生sql语句操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用django封装好的connection对象，会自动读取settings.py中数据库的配置信息</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取游标对象</span></span><br><span class="line">cursor = connection.cursor()</span><br><span class="line"><span class="comment"># 拿到游标对象后执行sql语句</span></span><br><span class="line">cursor.execute(<span class="string">"select * from book"</span>)</span><br><span class="line"><span class="comment"># 获取所有的数据</span></span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line"><span class="comment"># 遍历查询到的数据</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">    print(row)</span><br></pre></td></tr></table></figure>
<p>以上的<code>execute</code>以及<code>fetchall</code>方法都是<code>Python DB API</code>规范中定义好的。任何使用<code>Python</code>来操作<code>MySQL</code>的驱动程序都应该遵循这个规范。所以不管是使用<code>pymysql</code>或者是<code>mysqlclient</code>或者是<code>mysqldb</code>，他们的接口都是一样的。</p>
<h1 id="Python-DB-API下规范下cursor对象常用接口："><a href="#Python-DB-API下规范下cursor对象常用接口：" class="headerlink" title="Python DB API下规范下cursor对象常用接口："></a>Python DB API下规范下cursor对象常用接口：</h1><ol>
<li><code>description</code>：如果<code>cursor</code>执行了查询的<code>sql</code>代码。那么读取<code>cursor.description</code>属性的时候，将返回一个列表，这个列表中装的是元组，元组中装的分别是<code>(name,type_code,display_size,internal_size,precision,scale,null_ok)</code>，其中<code>name</code>代表的是查找出来的数据的字段名称，其他参数暂时用处不大。</li>
<li><code>rowcount</code>：代表的是在执行了<code>sql</code>语句后受影响的行数。</li>
<li><code>close</code>：关闭游标。关闭游标以后就再也不能使用了，否则会抛出异常。</li>
<li><code>execute(sql[,parameters])</code>：执行某个<code>sql</code>语句。如果在执行<code>sql</code>语句的时候还需要传递参数，那么可以传给<code>parameters</code>参数。示例代码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">"select * from article where id=%s"</span>,(<span class="number">1</span>,))</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><code>fetchone</code>：在执行了查询操作以后，获取第一条数据。</li>
<li><code>fetchmany(size)</code>：在执行查询操作以后，获取多条数据。具体是多少条要看传的<code>size</code>参数。如果不传<code>size</code>参数，那么默认是获取第一条数据。</li>
<li><code>fetchall</code>：获取所有满足<code>sql</code>语句的数据。</li>
</ol>
<h1 id="ORM模型的创建和映射："><a href="#ORM模型的创建和映射：" class="headerlink" title="ORM模型的创建和映射："></a>ORM模型的创建和映射：</h1><h2 id="创建ORM模型："><a href="#创建ORM模型：" class="headerlink" title="创建ORM模型："></a>创建ORM模型：</h2><p><code>ORM</code>模型一般都是放在<code>app</code>的<code>models.py</code>文件中。每个<code>app</code>都可以拥有自己的模型。并且如果这个模型想要映射到数据库中，那么这个<code>app</code>必须要放在<code>settings.py</code>的<code>INSTALLED_APP</code>中进行安装。以下是写一个简单的书籍<code>ORM</code>模型。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>,null=<span class="keyword">False</span>)</span><br><span class="line">    author = models.CharField(max_length=<span class="number">20</span>,null=<span class="keyword">False</span>)</span><br><span class="line">    pub_time = models.DateTimeField(default=datetime.now)</span><br><span class="line">    price = models.FloatField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>以上便定义了一个模型。这个模型继承自<code>django.db.models.Model</code>，如果这个模型想要映射到数据库中，就必须继承自这个类。这个模型以后映射到数据库中，表名是模型名称的小写形式，为<code>book</code>。在这个表中，有四个字段，一个为<code>name</code>，这个字段是保存的是书的名称，是<code>varchar</code>类型，最长不能超过20个字符，并且不能为空。第二个字段是作者名字类型，同样也是<code>varchar</code>类型，长度不能超过20个。第三个是出版时间，数据类型是<code>datetime</code>类型，默认是保存这本书籍的时间。第五个是这本书的价格，是浮点类型。<br>还有一个字段我们没有写，就是主键<code>id</code>，在<code>django</code>中，如果一个模型没有定义主键，那么将会自动生成一个自动增长的<code>int</code>类型的主键，并且这个主键的名字就叫做<code>id</code>。</p>
<h2 id="映射模型到数据库中："><a href="#映射模型到数据库中：" class="headerlink" title="映射模型到数据库中："></a>映射模型到数据库中：</h2><p>将<code>ORM</code>模型映射到数据库中，总结起来就是以下几步：</p>
<ol>
<li>在<code>settings.py</code>中，配置好<code>DATABASES</code>，做好数据库相关的配置。</li>
<li>在<code>app</code>中的<code>models.py</code>中定义好模型，这个模型必须继承自<code>django.db.models</code>。</li>
<li>将这个<code>app</code>添加到<code>settings.py</code>的<code>INSTALLED_APP</code>中。</li>
<li>在命令行终端，进入到项目所在的路径，然后执行命令<code>python manage.py makemigrations</code>来生成迁移脚本文件。</li>
<li>同样在命令行中，执行命令<code>python manage.py migrate</code>来将迁移脚本文件映射到数据库中。</li>
</ol>
<h1 id="ORM对数据库的基本操作"><a href="#ORM对数据库的基本操作" class="headerlink" title="ORM对数据库的基本操作"></a>ORM对数据库的基本操作</h1><h2 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h2><p>只要使用ORM模型创建一个对象。然后再调用这个ORM模型的<code>save</code>方法就可以保存了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book = Book(name=<span class="string">'西游记'</span>,author=<span class="string">'吴承恩'</span>,price=<span class="number">100</span>)</span><br><span class="line">book.save()</span><br></pre></td></tr></table></figure>
<h2 id="查找数据："><a href="#查找数据：" class="headerlink" title="查找数据："></a>查找数据：</h2><p>所有的查找工作都是使用模型上的<code>objects</code>属性来完成的。当然也可以自定义查询对象。这部分功能会在后面讲到。</p>
<ol>
<li>根据主键进行查找：使用主键进行查找。可以使用<code>objects.get</code>方法。然后传递<code>pk=xx</code>的方式进行查找。示例代码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book = Book.objects.get(pk=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>根据其他字段进行查找：可以使用<code>objects.filter</code>方法进行查找。示例代码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">books = Book.objects.filter(name=<span class="string">'三国演义'</span>)</span><br></pre></td></tr></table></figure>
<p>使用<code>filter</code>方法返回来的是一个<code>QuerySet</code>对象。这个对象类似于列表。我们可以使用这个对象的<code>first</code>方法来获取第一个值。</p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>首先查找到对应的数据模型。然后再执行这个模型的<code>delete</code>方法即可删除。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book = Book.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">book.delete()</span><br></pre></td></tr></table></figure>
<h2 id="修改数据："><a href="#修改数据：" class="headerlink" title="修改数据："></a>修改数据：</h2><p>首先查找到对应的数据模型。然后修改这个模型上的属性的值。再执行<code>save</code>方法即可修改完成。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book = Book.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">book.price = <span class="number">200</span></span><br><span class="line">book.save()</span><br></pre></td></tr></table></figure>
<h1 id="常用Field笔记："><a href="#常用Field笔记：" class="headerlink" title="常用Field笔记："></a>常用Field笔记：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 如果想要使用自己定义的Field来作为主键，那么必须设置primary_key=True</span></span><br><span class="line">    id = models.BigAutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 在定义字段的时候，如果没有指定null=True，那么默认情况下，null=False</span></span><br><span class="line">    <span class="comment"># 就是不能为空</span></span><br><span class="line">    <span class="comment"># 如果想要使用可以为null的BooleanField，那么应该使用NullBooleanField来代替</span></span><br><span class="line">    removed = models.NullBooleanField()</span><br><span class="line">    <span class="comment"># CharField：如果是超过了254个字符，那么就不建议使用啦</span></span><br><span class="line">    <span class="comment"># 就推荐使用TextField：longtext</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    <span class="comment"># auto_now_add：是在第一次添加数据进去的时候会自动获取当前的时间，创建时间</span></span><br><span class="line">    <span class="comment"># auto_now：每次这个对象调用save方法的时候都会将当前的时间更新，更新时间</span></span><br><span class="line">    create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<h2 id="navie时间和aware时间"><a href="#navie时间和aware时间" class="headerlink" title="navie时间和aware时间"></a>navie时间和aware时间</h2><ol>
<li>navie时间：不知道自己的时间表示的是哪个时区的。也就是不知道自己几斤几两。比较幼稚。</li>
<li>aware时间：知道自己的时间表示的是哪个时区的。也就是比较清醒。</li>
</ol>
<h3 id="pytz库"><a href="#pytz库" class="headerlink" title="pytz库"></a>pytz库</h3><p>专门用来处理时区的库。这个库会经常更新一些时区的数据，不需要我们担心。并且这个库在安装Django的时候会默认的安装。如果没有安装，那么可以通过<code>pip install pytz</code>的方式进行安装。</p>
<h3 id="astimezone方法："><a href="#astimezone方法：" class="headerlink" title="astimezone方法："></a>astimezone方法：</h3><p>将一个时区的时间转换为另外一个时区的时间。这个方法只能被<code>aware</code>类型的时间调用。不能被<code>navie</code>类型的时间调用。<br>示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">now = datetime.now() <span class="comment"># 这是一个navie类型的时间</span></span><br><span class="line">utc_timezone = pytz.timezone(<span class="string">"UTC"</span>) <span class="comment"># 定义UTC的时区对象</span></span><br><span class="line">utc_now = now.astimezone(utc_timezone) <span class="comment"># 将当前的时间转换为UTC时区的时间</span></span><br><span class="line">&gt;&gt; ValueError: astimezone() cannot be applied to a naive datetime <span class="comment"># 会抛出一个异常，原因就是因为navie类型的时间不能调用astimezone方法</span></span><br><span class="line"></span><br><span class="line">now = now.replace(tzinfo=pytz.timezone(<span class="string">'Asia/Shanghai'</span>))</span><br><span class="line">utc_now = now.astimezone(utc_timezone)</span><br><span class="line"><span class="comment"># 这时候就可以正确的转换。</span></span><br></pre></td></tr></table></figure>
<h3 id="replace方法"><a href="#replace方法" class="headerlink" title="replace方法"></a>replace方法</h3><p>可以将一个时间的某些属性进行更改。</p>
<h3 id="django-utils-timezone-now方法"><a href="#django-utils-timezone-now方法" class="headerlink" title="django.utils.timezone.now方法"></a>django.utils.timezone.now方法</h3><p>会根据<code>settings.py</code>中是否设置了<code>USE_TZ=True</code>获取当前的时间。如果设置了，那么就获取一个<code>aware</code>类型的<code>UTC</code>时间。如果没有设置，那么就会获取一个<code>navie</code>类型的时间。</p>
<h3 id="django-utils-timezone-localtime方法"><a href="#django-utils-timezone-localtime方法" class="headerlink" title="django.utils.timezone.localtime方法"></a>django.utils.timezone.localtime方法</h3><p>会根据<code>setting.py</code>中的<code>TIME_ZONE</code>来将一个<code>aware</code>类型的时间转换为<code>TIME_ZONE</code>指定时区的时间。<br>html模板中，会自动转换为当前时区时间。<code>views</code>中可以使用<code>localtime</code>转换为当前时区</p>
<h2 id="DateField："><a href="#DateField：" class="headerlink" title="DateField："></a>DateField：</h2><p>日期类型。在<code>Python</code>中是<code>datetime.date</code>类型，可以记录年月日。在映射到数据库中也是<code>date</code>类型。使用这个<code>Field</code>可以传递以下几个参数：</p>
<ol>
<li><code>auto_now</code>：在每次这个数据保存的时候，都使用当前的时间。比如作为一个记录修改日期的字段，可以将这个属性设置为<code>True</code>。</li>
<li><code>auto_now_add</code>：在每次数据第一次被添加进去的时候，都使用当前的时间。比如作为一个记录第一次入库的字段，可以将这个属性设置为<code>True</code>。</li>
</ol>
<h2 id="DateTimeField："><a href="#DateTimeField：" class="headerlink" title="DateTimeField："></a>DateTimeField：</h2><p>日期时间类型，类似于<code>DateField</code>。不仅仅可以存储日期，还可以存储时间。映射到数据库中是<code>datetime</code>类型。这个<code>Field</code>也可以使用<code>auto_now</code>和<code>auto_now_add</code>两个属性。</p>
<h2 id="TimeField："><a href="#TimeField：" class="headerlink" title="TimeField："></a>TimeField：</h2><p>时间类型。在数据库中是<code>time</code>类型。在<code>Python</code>中是<code>datetime.time</code>类型。</p>
<h2 id="EmailField："><a href="#EmailField：" class="headerlink" title="EmailField："></a>EmailField：</h2><p>类似于<code>CharField</code>。在数据库底层也是一个<code>varchar</code>类型。最大长度是254个字符。</p>
<h2 id="FileField："><a href="#FileField：" class="headerlink" title="FileField："></a>FileField：</h2><p>用来存储文件的。这个请参考后面的文件上传章节部分。</p>
<h3 id="ImageField："><a href="#ImageField：" class="headerlink" title="ImageField："></a>ImageField：</h3><p>用来存储图片文件的。这个请参考后面的图片上传章节部分。</p>
<h3 id="FloatField："><a href="#FloatField：" class="headerlink" title="FloatField："></a>FloatField：</h3><p>浮点类型。映射到数据库中是<code>float</code>类型。</p>
<h3 id="IntegerField："><a href="#IntegerField：" class="headerlink" title="IntegerField："></a>IntegerField：</h3><p>整形。值的区间是<code>-2147483648——2147483647</code>。</p>
<h3 id="BigIntegerField："><a href="#BigIntegerField：" class="headerlink" title="BigIntegerField："></a>BigIntegerField：</h3><p>大整形。值的区间是<code>-9223372036854775808——9223372036854775807</code>。</p>
<h3 id="PositiveIntegerField："><a href="#PositiveIntegerField：" class="headerlink" title="PositiveIntegerField："></a>PositiveIntegerField：</h3><p>正整形。值的区间是<code>0——2147483647</code>。</p>
<h3 id="SmallIntegerField："><a href="#SmallIntegerField：" class="headerlink" title="SmallIntegerField："></a>SmallIntegerField：</h3><p>小整形。值的区间是<code>-32768——32767</code>。</p>
<h3 id="PositiveSmallIntegerField："><a href="#PositiveSmallIntegerField：" class="headerlink" title="PositiveSmallIntegerField："></a>PositiveSmallIntegerField：</h3><p>正小整形。值的区间是<code>0——32767</code>。</p>
<h3 id="TextField："><a href="#TextField：" class="headerlink" title="TextField："></a>TextField：</h3><p>大量的文本类型。映射到数据库中是longtext类型。</p>
<h3 id="UUIDField："><a href="#UUIDField：" class="headerlink" title="UUIDField："></a>UUIDField：</h3><p>只能存储<code>uuid</code>格式的字符串。<code>uuid</code>是一个32位的全球唯一的字符串，一般用来作为主键。</p>
<h3 id="URLField："><a href="#URLField：" class="headerlink" title="URLField："></a>URLField：</h3><p>类似于<code>CharField</code>，只不过只能用来存储<code>url</code>格式的字符串。并且默认的<code>max_length</code>是200。</p>
<h2 id="Field常用的参数"><a href="#Field常用的参数" class="headerlink" title="Field常用的参数"></a>Field常用的参数</h2><h3 id="null："><a href="#null：" class="headerlink" title="null："></a>null：</h3><p>如果设置为<code>True</code>，<code>Django</code>将会在映射表的时候指定是否为空。默认是为<code>False</code>。在使用字符串相关的<code>Field</code>（CharField/TextField）的时候，官方推荐尽量不要使用这个参数，也就是保持默认值<code>False</code>。因为<code>Django</code>在处理字符串相关的<code>Field</code>的时候，即使这个<code>Field</code>的<code>null=False</code>，如果你没有给这个<code>Field</code>传递任何值，那么<code>Django</code>也会使用一个空的字符串<code>&quot;&quot;</code>来作为默认值存储进去。因此如果再使用<code>null=True</code>，<code>Django</code>会产生两种空值的情形（NULL或者空字符串）。如果想要在表单验证的时候允许这个字符串为空，那么建议使用<code>blank=True</code>。如果你的<code>Field</code>是<code>BooleanField</code>，那么对应的可空的字段则为<code>NullBooleanField</code>。</p>
<h3 id="blank："><a href="#blank：" class="headerlink" title="blank："></a>blank：</h3><p>标识这个字段在表单验证的时候是否可以为空。默认是<code>False</code>。<br>这个和<code>null</code>是有区别的，<code>null</code>是一个纯数据库级别的。而<code>blank</code>是表单验证级别的。</p>
<h3 id="db-column："><a href="#db-column：" class="headerlink" title="db_column："></a>db_column：</h3><p>这个字段在数据库中的名字。如果没有设置这个参数，那么将会使用模型中属性的名字。</p>
<h3 id="default："><a href="#default：" class="headerlink" title="default："></a>default：</h3><p>默认值。可以为一个值，或者是一个函数，但是不支持<code>lambda</code>表达式。并且不支持列表/字典/集合等可变的数据结构。</p>
<h3 id="primary-key："><a href="#primary-key：" class="headerlink" title="primary_key："></a>primary_key：</h3><p>是否为主键。默认是<code>False</code>。</p>
<h3 id="unique："><a href="#unique：" class="headerlink" title="unique："></a>unique：</h3><p>在表中这个字段的值是否唯一。一般是设置手机号码/邮箱等。</p>
<h2 id="模型中Meta配置"><a href="#模型中Meta配置" class="headerlink" title="模型中Meta配置"></a>模型中<code>Meta</code>配置</h2><p>对于一些模型级别的配置。我们可以在模型中定义一个类，叫做<code>Meta</code>。然后在这个类中添加一些类属性来控制模型的作用。比如我们想要在数据库映射的时候使用自己指定的表名，而不是使用模型的名称。那么我们可以在<code>Meta</code>类中添加一个<code>db_table</code>的属性。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>,null=<span class="keyword">False</span>)</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">100</span>,name=<span class="string">'description'</span>,db_column=<span class="string">"description1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">'book_model'</span></span><br></pre></td></tr></table></figure>
<p>以下将对<code>Meta</code>类中的一些常用配置进行解释。</p>
<h3 id="db-table："><a href="#db-table：" class="headerlink" title="db_table："></a>db_table：</h3><p>这个模型映射到数据库中的表名。如果没有指定这个参数，那么在映射的时候将会使用模型名来作为默认的表名。</p>
<h3 id="ordering："><a href="#ordering：" class="headerlink" title="ordering："></a>ordering：</h3><p>设置在提取数据的排序方式。后面章节会讲到如何查找数据。比如我想在查找数据的时候根据添加的时间排序，那么示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">20</span>,null=<span class="keyword">False</span>)</span><br><span class="line">desc = models.CharField(max_length=<span class="number">100</span>,name=<span class="string">'description'</span>,db_column=<span class="string">"description1"</span>)</span><br><span class="line">pub_date = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">db_table = <span class="string">'book_model'</span></span><br><span class="line">ordering = [<span class="string">'pub_date'</span>]     <span class="comment">#['-pub_date']是反向排序</span></span><br></pre></td></tr></table></figure>
<h1 id="外键和表关系"><a href="#外键和表关系" class="headerlink" title="外键和表关系"></a>外键和表关系</h1><h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><p>在<code>MySQL</code>中，表有两种引擎，一种是<code>InnoDB</code>，另外一种是<code>myisam</code>。如果使用的是<code>InnoDB</code>引擎，是支持外键约束的。外键的存在使得<code>ORM</code>框架在处理表关系的时候异常的强大。因此这里我们首先来介绍下外键在Django中的使用。</p>
<p>类定义为<code>class ForeignKey(to,on_delete,**options)</code>。第一个参数是引用的是哪个模型，第二个参数是在使用外键引用的模型数据被删除了，这个字段该如何处理，比如有<code>CASCADE</code>、<code>SET_NULL</code>等。这里以一个实际案例来说明。比如有一个<code>User</code>和一个<code>Article</code>两个模型。一个<code>User</code>可以发表多篇文章，一个<code>Article</code>只能有一个<code>Author</code>，并且通过外键进行引用。那么相关的示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    author = models.ForeignKey(<span class="string">"User"</span>,on_delete=models.CASCADE)  <span class="comment">#外键</span></span><br></pre></td></tr></table></figure>
<p>以上使用ForeignKey来定义模型之间的关系。即在article的实例中可以通过author属性来操作对应的User模型。这样使用起来非常的方便。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">article = Article(title=<span class="string">'abc'</span>,content=<span class="string">'123'</span>)</span><br><span class="line">author = User(username=<span class="string">'张三'</span>,password=<span class="string">'111111'</span>)</span><br><span class="line">article.author = author</span><br><span class="line">article.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改article.author上的值</span></span><br><span class="line">article.author.username = <span class="string">'李四'</span></span><br><span class="line">article.save()</span><br></pre></td></tr></table></figure>
<p>为什么使用了<code>ForeignKey</code>后，就能通过<code>author</code>访问到对应的<code>user</code>对象呢。因此在底层，<code>Django</code>为<code>Article</code>表添加了一个属性名<code>_id</code>的字段（比如<code>author</code>的字段名称是<code>author_id</code>），这个字段是一个外键，记录着对应的作者的主键。以后通过<code>article.author</code>访问的时候，实际上是先通过<code>author_id</code>找到对应的数据，然后再提取<code>User</code>表中的这条数据，形成一个模型。</p>
<p>如果想要引用另外一个app的模型，那么应该在传递to参数的时候，使用<code>app.model_name</code>进行指定。以上例为例，如果<code>User</code>和<code>Article</code>不是在同一个<code>app</code>中，那么在引用的时候的示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># User模型在user这个app中</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Article模型在article这个app中</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    author = models.ForeignKey(<span class="string">"user.User"</span>,on_delete=models.CASCADE)  <span class="comment">#引用时指定所在app，app.model_name</span></span><br></pre></td></tr></table></figure>
<p>如果模型的外键引用的是本身自己这个模型，那么<code>to</code>参数可以为<code>self</code>，或者是这个模型的名字。在论坛开发中，一般评论都可以进行二级评论，即可以针对另外一个评论进行评论，那么在定义模型的时候就需要使用外键来引用自身。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    content = models.TextField()</span><br><span class="line">    origin_comment = models.ForeignKey(<span class="string">'self'</span>,on_delete=models.CASCADE,null=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 或者</span></span><br><span class="line">    <span class="comment"># origin_comment = models.ForeignKey('Comment',on_delete=models.CASCADE,null=True)</span></span><br></pre></td></tr></table></figure>
<h2 id="外键删除操作"><a href="#外键删除操作" class="headerlink" title="外键删除操作"></a>外键删除操作</h2><p>如果一个模型使用了外键。那么在对方那个模型被删掉后，该进行什么样的操作。可以通过<code>on_delete</code>来指定。可以指定的类型如下：</p>
<ol>
<li><code>CASCADE</code>：级联操作。如果外键对应的那条数据被删除了，那么这条数据也会被删除。</li>
<li><code>PROTECT</code>：受保护。即只要这条数据引用了外键的那条数据，那么就不能删除外键的那条数据。</li>
<li><code>SET_NULL</code>：设置为空。如果外键的那条数据被删除了，那么在本条数据上就将这个字段设置为空。如果设置这个选项，前提是要指定这个字段可以为空。</li>
<li><code>SET_DEFAULT</code>：设置默认值。如果外键的那条数据被删除了，那么本条数据上就将这个字段设置为默认值。如果设置这个选项，前提是要指定这个字段一个默认值。</li>
<li><code>SET()</code>：如果外键的那条数据被删除了。那么将会获取SET函数中的值来作为这个外键的值。SET函数可以接收一个可以调用的对象（比如函数或者方法），如果是可以调用的对象，那么会将这个对象调用后的结果作为值返回回去。</li>
<li><code>DO_NOTHING</code>：不采取任何行为。一切全看数据库级别的约束。</li>
</ol>
<p><strong>以上这些选项只是Django级别的，数据级别依旧是RESTRICT！</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    category = models.ForeignKey(<span class="string">'Category'</span>, on_delete=models.SET(Category.objects.get(pk=<span class="number">4</span>)), null=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<h2 id="表关系笔记："><a href="#表关系笔记：" class="headerlink" title="表关系笔记："></a>表关系笔记：</h2><h3 id="一对多："><a href="#一对多：" class="headerlink" title="一对多："></a>一对多：</h3><ol>
<li>应用场景：比如文章和作者之间的关系。一个文章只能由一个作者编写，但是一个作者可以写多篇文章。文章和作者之间的关系就是典型的多对一的关系。</li>
<li>实现方式：一对多或者多对一，都是通过<code>ForeignKey</code>来实现的。还是以文章和作者的案例进行讲解。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    author = models.ForeignKey(<span class="string">"User"</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<p>那么以后在给<code>Article</code>对象指定<code>author</code>，就可以使用以下代码来完成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">article = Article(title=<span class="string">'abc'</span>,content=<span class="string">'123'</span>)</span><br><span class="line">author = User(username=<span class="string">'zhiliao'</span>,password=<span class="string">'111111'</span>)</span><br><span class="line"><span class="comment"># 要先保存到数据库中</span></span><br><span class="line">author.save()</span><br><span class="line">article.author = author</span><br><span class="line">article.save()</span><br></pre></td></tr></table></figure>
<p>并且以后如果想要获取某个用户下所有的文章，可以通过<code>article_set</code>来实现。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user = User.objects.first()</span><br><span class="line"><span class="comment"># 获取第一个用户写的所有文章</span></span><br><span class="line">articles = user.article_set.all()</span><br><span class="line"><span class="keyword">for</span> article <span class="keyword">in</span> articles:</span><br><span class="line">    print(article)</span><br></pre></td></tr></table></figure>
<p>并且如果想要将文章添加到某个分类中。可以使用一下的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">category = Category.objects.first()</span><br><span class="line">article = Article(title=<span class="string">'bbb'</span>,content=<span class="string">'vvv'</span>)</span><br><span class="line">article.author = FrontUser.objects.first()</span><br><span class="line">category.article_set.add(article,bulk=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>bulk=False</code>，那么Django会自动的保存article，而不需要在添加到category之前先保存article。</li>
<li>或者是另外一种解决方式是，在添加到<code>category.article_set</code>中之前，先将<code>article</code>保存到数据库中。但是如果<code>article.category</code>不能为空，那么就产生一种死循环了，article没有<code>category</code>不能保存，而将article添加到<code>cateogry.artile_set</code>中，又需要article之前是已经存储到数据库中的。</li>
<li>如果是上面的那种需求，建议使用<code>bulk=False</code>的解决方案。</li>
</ul>
<h3 id="一对一："><a href="#一对一：" class="headerlink" title="一对一："></a>一对一：</h3><ol>
<li>在Django中一对一是通过<code>models.OnetToOneField</code>来实现的。这个<code>OneToOneField</code>其实本质上就是一个外键，只不过这个外键有一个<code>唯一约束（unique key）</code>，来实现一对一。</li>
<li>以后如果想要反向引用，那么是通过引用的模型的名字转换为小写的形式进行访问。比如以下模型：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrontUser</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserExtension</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    school = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    user = models.OneToOneField(<span class="string">"FrontUser"</span>,on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过userextension来访问UserExtension对象</span></span><br><span class="line">user = FrontUser.objects.first()</span><br><span class="line">print(user.userextension)</span><br></pre></td></tr></table></figure>
<p><code>UserExtension</code>的对象，可以通过<code>user</code>来访问到对应的user对象。并且<code>FrontUser</code>对象可以使用<code>userextension</code>来访问对应的<code>UserExtension</code>对象。<br>如果不想使用Django默认的引用属性名字。那么可以在<code>OneToOneField</code>中添加一个<code>related_name</code>参数。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrontUser</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserExtension</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    school = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    user = models.OneToOneField(<span class="string">"FrontUser"</span>,on_delete=models.CASCADE,related_name=<span class="string">'extension'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过extension来访问到UserExtension对象</span></span><br><span class="line">user = FrontUser.objects.first()</span><br><span class="line">print(user.extension)</span><br></pre></td></tr></table></figure>
<p>那么以后就<code>FrontUser</code>的对象就可以通过<code>extension</code>属性来访问到对应的<code>UserExtension</code>对象。</p>
<h3 id="多对多："><a href="#多对多：" class="headerlink" title="多对多："></a>多对多：</h3><ol>
<li><p>应用场景：比如文章和标签的关系。一篇文章可以有多个标签，一个标签可以被多个文章所引用。因此标签和文章的关系是典型的多对多的关系。</p>
</li>
<li><p>实现方式：<code>Django</code>为这种多对多的实现提供了专门的<code>Field</code>。叫做<code>ManyToManyField</code>。还是拿文章和标签为例进行讲解。示例代码如下：</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    tags = models.ManyToManyField(<span class="string">"Tag"</span>,related_name=<span class="string">"articles"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<p>在数据库层面，实际上<code>Django</code>是为这种多对多的关系建立了一个中间表。这个中间表分别定义了两个外键，引用到<code>article</code>和<code>tag</code>两张表的主键。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">many_to_many_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># article = Article.objects.first()  #获得文章</span></span><br><span class="line">    <span class="comment"># tag = Tag(name='冷门文章')    #新建标签</span></span><br><span class="line">    <span class="comment"># tag.save()</span></span><br><span class="line">    <span class="comment"># article.tag_set.add(tag)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># tag = Tag.objects.get(pk=1)</span></span><br><span class="line">    <span class="comment"># article = Article.objects.get(pk=3)</span></span><br><span class="line">    <span class="comment"># tag.articles.add(article)</span></span><br><span class="line"></span><br><span class="line">    article = Article.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">    tags = article.tags.all()</span><br><span class="line">    <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">        print(tag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"success"</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>赞赏作者</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatreward.png" alt="WP 微信支付">
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/django/" rel="tag"># django</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/14/django笔记03/" rel="next" title="django笔记03 - 模板">
                <i class="fa fa-chevron-left"></i> django笔记03 - 模板
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/27/HTML笔记/" rel="prev" title="HTML笔记">
                HTML笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/memory.jpg" alt="WP">
            
              <p class="site-author-name" itemprop="name">WP</p>
              <p class="site-description motion-element" itemprop="description">飞机从头顶飞过<br>流星也划破那夜空</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Django配置连接数据库"><span class="nav-number">1.</span> <span class="nav-text">Django配置连接数据库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在Django中操作数据库"><span class="nav-number">2.</span> <span class="nav-text">在Django中操作数据库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Python-DB-API下规范下cursor对象常用接口："><span class="nav-number">3.</span> <span class="nav-text">Python DB API下规范下cursor对象常用接口：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ORM模型的创建和映射："><span class="nav-number">4.</span> <span class="nav-text">ORM模型的创建和映射：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建ORM模型："><span class="nav-number">4.1.</span> <span class="nav-text">创建ORM模型：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#映射模型到数据库中："><span class="nav-number">4.2.</span> <span class="nav-text">映射模型到数据库中：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ORM对数据库的基本操作"><span class="nav-number">5.</span> <span class="nav-text">ORM对数据库的基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#添加数据"><span class="nav-number">5.1.</span> <span class="nav-text">添加数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找数据："><span class="nav-number">5.2.</span> <span class="nav-text">查找数据：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除数据"><span class="nav-number">5.3.</span> <span class="nav-text">删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改数据："><span class="nav-number">5.4.</span> <span class="nav-text">修改数据：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用Field笔记："><span class="nav-number">6.</span> <span class="nav-text">常用Field笔记：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#navie时间和aware时间"><span class="nav-number">6.1.</span> <span class="nav-text">navie时间和aware时间</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pytz库"><span class="nav-number">6.1.1.</span> <span class="nav-text">pytz库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#astimezone方法："><span class="nav-number">6.1.2.</span> <span class="nav-text">astimezone方法：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#replace方法"><span class="nav-number">6.1.3.</span> <span class="nav-text">replace方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#django-utils-timezone-now方法"><span class="nav-number">6.1.4.</span> <span class="nav-text">django.utils.timezone.now方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#django-utils-timezone-localtime方法"><span class="nav-number">6.1.5.</span> <span class="nav-text">django.utils.timezone.localtime方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DateField："><span class="nav-number">6.2.</span> <span class="nav-text">DateField：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DateTimeField："><span class="nav-number">6.3.</span> <span class="nav-text">DateTimeField：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TimeField："><span class="nav-number">6.4.</span> <span class="nav-text">TimeField：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EmailField："><span class="nav-number">6.5.</span> <span class="nav-text">EmailField：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FileField："><span class="nav-number">6.6.</span> <span class="nav-text">FileField：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ImageField："><span class="nav-number">6.6.1.</span> <span class="nav-text">ImageField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FloatField："><span class="nav-number">6.6.2.</span> <span class="nav-text">FloatField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IntegerField："><span class="nav-number">6.6.3.</span> <span class="nav-text">IntegerField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BigIntegerField："><span class="nav-number">6.6.4.</span> <span class="nav-text">BigIntegerField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PositiveIntegerField："><span class="nav-number">6.6.5.</span> <span class="nav-text">PositiveIntegerField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SmallIntegerField："><span class="nav-number">6.6.6.</span> <span class="nav-text">SmallIntegerField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PositiveSmallIntegerField："><span class="nav-number">6.6.7.</span> <span class="nav-text">PositiveSmallIntegerField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TextField："><span class="nav-number">6.6.8.</span> <span class="nav-text">TextField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UUIDField："><span class="nav-number">6.6.9.</span> <span class="nav-text">UUIDField：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URLField："><span class="nav-number">6.6.10.</span> <span class="nav-text">URLField：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field常用的参数"><span class="nav-number">6.7.</span> <span class="nav-text">Field常用的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null："><span class="nav-number">6.7.1.</span> <span class="nav-text">null：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blank："><span class="nav-number">6.7.2.</span> <span class="nav-text">blank：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#db-column："><span class="nav-number">6.7.3.</span> <span class="nav-text">db_column：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#default："><span class="nav-number">6.7.4.</span> <span class="nav-text">default：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#primary-key："><span class="nav-number">6.7.5.</span> <span class="nav-text">primary_key：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unique："><span class="nav-number">6.7.6.</span> <span class="nav-text">unique：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模型中Meta配置"><span class="nav-number">6.8.</span> <span class="nav-text">模型中Meta配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#db-table："><span class="nav-number">6.8.1.</span> <span class="nav-text">db_table：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ordering："><span class="nav-number">6.8.2.</span> <span class="nav-text">ordering：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#外键和表关系"><span class="nav-number">7.</span> <span class="nav-text">外键和表关系</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#外键"><span class="nav-number">7.1.</span> <span class="nav-text">外键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#外键删除操作"><span class="nav-number">7.2.</span> <span class="nav-text">外键删除操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表关系笔记："><span class="nav-number">7.3.</span> <span class="nav-text">表关系笔记：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一对多："><span class="nav-number">7.3.1.</span> <span class="nav-text">一对多：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对一："><span class="nav-number">7.3.2.</span> <span class="nav-text">一对一：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多："><span class="nav-number">7.3.3.</span> <span class="nav-text">多对多：</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WP</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">44k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">1:20</span>
  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>



  
  











  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/three/three.min.js"></script>

  
  <script src="/lib/three/three-waves.min.js"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  
  




  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail';
  guest = guest.split(',').filter(function (item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'IrCihvbStzYVX1cVfwYfUjpt-gzGzoHsz',
    appKey: 'U1FLNq52nK27I2BQq9TCSAdt',
    placeholder: '来玩啊',
    avatar: 'mp',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true
  });
</script>



  





  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
